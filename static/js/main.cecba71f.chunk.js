(this["webpackJsonppwa-demo"]=this["webpackJsonppwa-demo"]||[]).push([[0],[,,function(e,t,n){e.exports={wrapper:"TaskCard_wrapper__2pwFH",milestones:"TaskCard_milestones__aQ1Fm",milestone:"TaskCard_milestone__1ZgSQ",complete:"TaskCard_complete__2qkrJ",photos:"TaskCard_photos__2EWg6",photo:"TaskCard_photo__qubp1",photoButtons:"TaskCard_photoButtons__2b_1j",addPhoto:"TaskCard_addPhoto__2k0jz",remove:"TaskCard_remove__5Qf8u",buttons:"TaskCard_buttons__1SyS5",completeButton:"TaskCard_completeButton__oOeo0",resetButton:"TaskCard_resetButton__3Nj-C"}},,,,,,function(e,t,n){e.exports={wrapper:"TakePhoto_wrapper__2IAC6",video:"TakePhoto_video__3jRgH",buttons:"TakePhoto_buttons__10Dcp",backButton:"TakePhoto_backButton__mVHoW",takePhotoButton:"TakePhoto_takePhotoButton__3jwSX"}},,,,,function(e,t,n){e.exports={wrapper:"App_wrapper__2yWJv",footer:"App_footer__2nLYZ",addToHome:"App_addToHome__3og-F",accepted:"App_accepted__F_590"}},,,,function(e,t,n){},function(e,t,n){e.exports={wrapper:"TasksList_wrapper__19HVx"}},,,,,,function(e,t,n){},function(e,t,n){},,,function(e,t,n){"use strict";n.r(t);var a=n(1),o=n.n(a),r=n(16),c=n.n(r),s=(n(24),n(25),n(4)),i=n(13),d=n.n(i),l=n(11),u=n(3),j=function(e,t){switch(t.type){case"LoadTasks":return Object(u.a)(Object(u.a)({},e),{},{tasks:Object(l.a)(t.value)});case"UpdateTask":var n=e.tasks.findIndex((function(e){return e._id===t.task._id}));if(!n)return e;var a=e.tasks;return a[n]=Object(u.a)({},t.task),Object(u.a)(Object(u.a)({},e),{},{tasks:Object(l.a)(a)});default:return e}},p={tasks:[]},h=n(0),b=Object(a.createContext)([p,function(){}]),f=function(e){var t=e.children,n=Object(a.useReducer)(j,p),o=Object(s.a)(n,2),r=o[0],c=o[1];return Object(h.jsx)(b.Provider,{value:[r,c],children:t})},v=n(17),m=n.n(v),O=n(6),k=n.n(O),w=n(18),x=n.n(w),_=n(7),g=n(5),S=n.n(g),C=n(2),T=n.n(C),N=function(e){if(!e)return"";try{var t=new Date(e);return"".concat(t.getHours(),":").concat(t.getMinutes().toString().padStart(2,"0"))}catch(n){return""}},E=function(e){var t=new FileReader,n=new Promise((function(e,n){t.addEventListener("load",(function(t){var a;if((null===(a=t.target)||void 0===a?void 0:a.readyState)===FileReader.DONE){var o=new Image;o.addEventListener("load",(function(){return e(o)})),o.src=t.target.result}else n("File could not be loaded")}))}));return t.readAsDataURL(e),n},y=function(e){var t=e instanceof HTMLVideoElement?e.videoWidth:e.width,n=e instanceof HTMLVideoElement?e.videoHeight:e.height,a=Math.max(n/800,t/800,1),o=t/a,r=n/a,c=document.createElement("canvas");c.height=r,c.width=o;var s=c.getContext("2d");if(!s)throw new Error("Unable to create context");return s.drawImage(e,0,0,o,r),c.toDataURL("image/webp",.8)},P=function(e){var t=e.className,n=e.task,a=e.onPhotoRemove,o=e.onCompleteStep,r=e.onPhotoCaptureStart,c=e.onReset,s=e.onImageAdded,i=function(){var e=Object(_.a)(S.a.mark((function e(t){var n,a,o;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=t.target.files&&t.target.files[0])){e.next=7;break}return e.next=4,E(n);case 4:a=e.sent,o=y(a),s(o);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(h.jsxs)("div",{className:k()(T.a.wrapper,t),children:[Object(h.jsxs)("header",{children:[Object(h.jsx)("div",{children:Object(h.jsx)("b",{children:n.location})}),Object(h.jsx)("div",{children:n.description})]}),Object(h.jsxs)("div",{className:T.a.milestones,children:[Object(h.jsxs)("ul",{children:[Object(h.jsxs)("li",{className:k()(T.a.milestone,n.travelStart&&T.a.complete),children:[Object(h.jsx)("b",{children:"Travel started "}),Object(h.jsx)("span",{children:N(n.travelStart)})]}),n.travelStart&&Object(h.jsxs)("li",{className:k()(T.a.milestone,n.travelEnd&&T.a.complete),children:[Object(h.jsx)("b",{children:"Travel finished "}),Object(h.jsx)("span",{children:N(n.travelEnd)})]}),n.travelEnd&&Object(h.jsxs)("li",{className:k()(T.a.milestone,n.workStart&&T.a.complete),children:[Object(h.jsx)("b",{children:"Work started "}),Object(h.jsx)("span",{children:N(n.workStart)})]}),n.workStart&&Object(h.jsxs)("li",{className:k()(T.a.milestone,n.workEnd&&T.a.complete),children:[Object(h.jsx)("b",{children:"Work finished "}),Object(h.jsx)("span",{children:N(n.workEnd)})]})]}),Object(h.jsxs)("div",{className:T.a.buttons,children:[Object(h.jsx)("button",{className:T.a.completeButton,onClick:o,disabled:!!n.workEnd,children:"\u25b6"}),Object(h.jsx)("button",{className:T.a.resetButton,onClick:c,children:"Reset"})]})]}),Object(h.jsx)("div",{className:T.a.photos,children:n.photos&&n.photos.map((function(e,t){return Object(h.jsxs)("div",{className:T.a.photo,onClick:function(){return a(t)},children:[Object(h.jsx)("img",{alt:"",src:e}),Object(h.jsx)("span",{className:T.a.remove,children:"\xd7"})]},t)}))}),Object(h.jsxs)("div",{className:T.a.photoButtons,children:[Object(h.jsx)("div",{className:T.a.addPhoto,onClick:r,children:"\ud83d\udcf9"}),Object(h.jsxs)("label",{className:T.a.addPhoto,children:["\ud83d\udcf7",Object(h.jsx)("input",{className:"visually-hidden",type:"file",accept:"image/*",capture:"environment",onChange:i})]}),Object(h.jsxs)("label",{className:T.a.addPhoto,children:["\ud83d\udcce",Object(h.jsx)("input",{className:"visually-hidden",type:"file",accept:"image/*",onChange:i})]})]})]})},B=Object(a.memo)(P),R=n(8),A=n.n(R),L=function(e){var t=e.onPhoto,n=e.onCancel,o=Object(a.useRef)(null),r=Object(a.useState)(null),c=Object(s.a)(r,2),i=c[0],d=c[1],l=Object(a.useState)(!1),u=Object(s.a)(l,2),j=u[0],p=u[1],b=Object(a.useState)(void 0),f=Object(s.a)(b,2),v=f[0],m=f[1],O=Object(a.useCallback)(Object(_.a)(S.a.mark((function e(){var t;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!o.current){e.next=10;break}return o.current.addEventListener("loadedmetadata",(function(){console.log("video ready");var e=null===i||void 0===i?void 0:i.getVideoTracks()[0].getCapabilities();m(e),p(!0)})),o.current.addEventListener("loadeddata",(function(){o.current&&o.current.play()})),o.current.addEventListener("ended",(function(){console.log("stream ended"),d(null),p(!1)})),e.next=6,navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment"}});case 6:t=e.sent,console.log("setting stream"),d(t),o.current.srcObject=t;case 10:case"end":return e.stop()}}),e)}))),[i]);Object(a.useEffect)((function(){var e=o.current;return i||O(),function(){e&&e.pause(),i&&i.getTracks().forEach((function(e){e.stop()}))}}),[O,i]);var w=Object(a.useCallback)((function(e){var t=null===i||void 0===i?void 0:i.getVideoTracks(),n=t&&t[0];n&&j&&v.torch&&n.applyConstraints({advanced:[{torch:e}]}).then((function(){console.log("torch is ".concat(e?"on":"off"))}))}),[null===v||void 0===v?void 0:v.torch,j,i]);return Object(h.jsxs)("div",{className:k()(A.a.wrapper),children:[Object(h.jsx)("video",{className:A.a.video,ref:o,muted:!0,playsInline:!0}),Object(h.jsxs)("div",{className:A.a.buttons,children:[Object(h.jsx)("button",{className:A.a.backButton,onClick:n,children:"Back"}),Object(h.jsx)("button",{className:A.a.takePhotoButton,onClick:function(){var e=o.current;e&&t(y(e))},disabled:!j,children:"Take photo!"}),Object(h.jsx)("button",{className:A.a.torchButton,onClick:function(){return w(!0)},disabled:!j,children:"Flash"})]}),Object(h.jsx)("div",{style:{fontSize:"10px"},children:JSON.stringify(v)})]})},W=function(e){var t=e.className,n=e.onPhotoRemove,o=e.tasks,r=e.onCompleteStep,c=e.onPhotoAdd,i=e.onTaskReset,d=Object(a.useState)(null),l=Object(s.a)(d,2),u=l[0],j=l[1];return Object(h.jsxs)("div",{className:k()(x.a.wrapper,t),children:[Object(h.jsx)("ul",{children:o.map((function(e){return Object(h.jsx)("li",{children:Object(h.jsx)(B,{task:e,onPhotoRemove:function(t){return n(e,t)},onPhotoCaptureStart:function(){return j(e)},onImageAdded:function(t){return c(e,t)},onCompleteStep:function(){return r(e)},onReset:function(){return i(e)}})},e._id)}))}),u&&Object(h.jsx)(L,{onCancel:function(){return j(null)},onPhoto:function(e){c(u,e),j(null)}})]})},H=n(9),I=n(10),D=Object(H.a)((function e(t){Object(I.a)(this,e),this.value=t,this.type="LoadTasks"})),U=Object(H.a)((function e(t){Object(I.a)(this,e),this.task=t,this.type="UpdateTask"})),F=n(19),M=["_id"],J="https://crudcrud.com/api/1aa10a5e89e24398bd56391f380dddd3";function V(){return(V=Object(_.a)(S.a.mark((function e(){var t,n;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(J,"/tasks"));case 2:return t=e.sent,e.next=5,t.json();case 5:return n=e.sent,e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Q(e){return q.apply(this,arguments)}function q(){return(q=Object(_.a)(S.a.mark((function e(t){var n,a,o;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t._id,a=Object(F.a)(t,M),e.next=3,fetch("".concat(J,"/tasks/").concat(n),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});case 3:return o=e.sent,e.abrupt("return",o);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var z=function(){var e=Object(a.useContext)(b),t=Object(s.a)(e,2),n=t[0].tasks,o=t[1];Object(a.useEffect)((function(){(function(){return V.apply(this,arguments)})().then((function(e){return o(new D(e))}))}),[o]);return Object(h.jsx)("div",{className:m.a.wrapper,children:Object(h.jsx)(W,{tasks:n,onPhotoRemove:function(e,t){var n=Object(l.a)(e.photos),a=Object(u.a)(Object(u.a)({},e),{},{photos:n.splice(t,1)});Q(a),o(new U(a))},onPhotoAdd:function(e,t){var n=e.photos||[],a=Object(u.a)(Object(u.a)({},e),{},{photos:[].concat(Object(l.a)(n),[t])});Q(a),o(new U(a))},onCompleteStep:function(e){var t=Object(u.a)({},e);t.workEnd||(t.workStart?t.workEnd=(new Date).toISOString():t.travelEnd?t.workStart=(new Date).toISOString():t.travelStart?t.travelEnd=(new Date).toISOString():t.travelStart=(new Date).toISOString()),Q(t),o(new U(t))},onTaskReset:function(e){var t=Object(u.a)(Object(u.a)({},e),{},{workEnd:void 0,workStart:void 0,travelEnd:void 0,travelStart:void 0});Q(t),o(new U(t))}})})},Z="0.4.9",X=function(){var e=Object(a.useState)(null),t=Object(s.a)(e,2),n=t[0],o=t[1],r=Object(a.useState)(!1),c=Object(s.a)(r,2),i=c[0],l=c[1];!function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window,o=Object(a.useRef)();Object(a.useEffect)((function(){o.current=t}),[t]),Object(a.useEffect)((function(){if(o.current){var t=o.current,a=function(e){return t(e)};return n.addEventListener(e,a),function(){n.removeEventListener(e,a)}}}),[e,n])}("beforeinstallprompt",(function(e){e.preventDefault(),o(e)}));var u;return Object(h.jsxs)("div",{className:d.a.wrapper,children:[n&&Object(h.jsx)("button",{className:d.a.addToHome,onClick:(u=n,function(){u.prompt(),u.userChoice.then((function(e){l("accepted"===e.outcome),setTimeout((function(){return l(!1)}),5e3),o(null)}))}),children:"Add to Home"}),i&&Object(h.jsx)("div",{className:d.a.accepted,children:"Added to Home Screen"}),Object(h.jsx)(f,{children:Object(h.jsx)(z,{})}),Object(h.jsxs)("footer",{className:d.a.footer,children:["version ",Z," UA ",navigator.userAgent]})]})},Y=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function $(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}c.a.render(Object(h.jsx)(o.a.StrictMode,{children:Object(h.jsx)(X,{})}),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/pwa-demo",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/pwa-demo","/service-worker.js");Y?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):$(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):$(t,e)}))}}()}],[[28,1,2]]]);
//# sourceMappingURL=main.cecba71f.chunk.js.map