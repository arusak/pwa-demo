{"version":3,"sources":["components/TaskCard/TaskCard.module.css","components/TakePhoto/TakePhoto.module.css","App.module.css","components/TasksList/TasksList.module.css","state/state.reducer.ts","state/state.context.tsx","utils/date.utils.ts","components/TaskCard/TaskCard.tsx","components/TakePhoto/TakePhoto.tsx","components/TasksList/TasksList.tsx","state/state.actions.ts","services/data.service.ts","scenes/TasksScene/TasksScene.tsx","App.tsx","serviceWorkerRegistration.ts","index.tsx"],"names":["module","exports","reducer","state","action","type","tasks","value","taskIdx","findIndex","t","_id","task","initialState","StateContext","createContext","StateProvider","children","useReducer","dispatch","Provider","formatTime","str","date","Date","getHours","getMinutes","toString","padStart","e","TaskCard","className","onPhotoRemove","onCompleteStep","onPhotoAddStart","onReset","cn","s","wrapper","location","description","milestones","milestone","travelStart","complete","travelEnd","workStart","workEnd","buttons","completeButton","onClick","disabled","resetButton","photos","map","photo","idx","alt","src","remove","addPhoto","memo","TakePhoto","onPhoto","onCancel","videoRef","useRef","useState","stream","setStream","isVideoReady","setReady","isTorchOn","setTorchOn","initStream","useCallback","a","current","addEventListener","console","log","navigator","mediaDevices","getUserMedia","audio","video","facingMode","srcObject","useEffect","pause","getTracks","forEach","track","stop","tracks","getVideoTracks","videoTrack","capabilities","getCapabilities","torch","applyConstraints","advanced","flash","ref","autoPlay","muted","playsInline","backButton","takePhotoButton","videoCanvas","document","createElement","height","videoHeight","width","videoWidth","videoContext","getContext","drawImage","dataUrl","toDataURL","torchButton","TasksList","onPhotoAdd","onTaskReset","photoTask","setPhotoTask","index","data","LoadTasksAction","UpdateTaskAction","base","fetch","response","json","updateTask","content","method","headers","body","JSON","stringify","TasksScene","useContext","fetchTasks","then","updated","splice","toISOString","undefined","App","isLocalhost","Boolean","window","hostname","match","registerValidSW","swUrl","config","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","catch","error","ReactDOM","render","StrictMode","getElementById","URL","process","href","origin","contentType","get","status","indexOf","ready","unregister","reload","checkValidServiceWorker","serviceWorkerRegistration"],"mappings":"6FACAA,EAAOC,QAAU,CAAC,QAAU,0BAA0B,WAAa,6BAA6B,UAAY,4BAA4B,SAAW,2BAA2B,OAAS,yBAAyB,MAAQ,wBAAwB,SAAW,2BAA2B,OAAS,yBAAyB,QAAU,0BAA0B,eAAiB,iCAAiC,YAAc,gC,oBCA5ZD,EAAOC,QAAU,CAAC,QAAU,2BAA2B,MAAQ,yBAAyB,QAAU,2BAA2B,WAAa,8BAA8B,gBAAkB,qC,wBCA1LD,EAAOC,QAAU,CAAC,QAAU,uB,kCCA5BD,EAAOC,QAAU,CAAC,QAAU,6B,yKCMfC,EAAU,SAACC,EAAcC,GAClC,OAAQA,EAAOC,MACX,IAAK,YACD,OAAO,2BACAF,GADP,IAEIG,MAAM,YAAKF,EAAOG,SAG1B,IAAK,aACD,IAAMC,EAAUL,EAAMG,MAAMG,WAAU,SAAAC,GAAC,OAAIA,EAAEC,MAAQP,EAAOQ,KAAKD,OACjE,IAAKH,EACD,OAAOL,EAEX,IAAMG,EAAQH,EAAMG,MAEpB,OADAA,EAAME,GAAN,eAAsBJ,EAAOQ,MACtB,2BACAT,GADP,IAEIG,MAAM,YAAKA,KAInB,QACI,OAAOH,IAINU,EAAsB,CAC/BP,MAAO,I,OC9BEQ,EAAeC,wBAE1B,CAACF,EAAc,eAEJG,EAAgB,SAAC,GAA2C,IAAzCC,EAAwC,EAAxCA,SAC5B,EAA0BC,qBAAWhB,EAASW,GAA9C,mBAAOV,EAAP,KAAcgB,EAAd,KACA,OACI,cAACL,EAAaM,SAAd,CAAuBb,MAAO,CAACJ,EAAOgB,GAAtC,SACKF,K,kECZAI,EAAa,SAACC,GACvB,IAAKA,EACD,MAAO,GAEX,IACI,IAAMC,EAAO,IAAIC,KAAKF,GACtB,MAAM,GAAN,OAAUC,EAAKE,WAAf,YAA6BF,EAAKG,aAAaC,WAAWC,SAAS,EAAG,MACxE,MAAOC,GACL,MAAO,KCQTC,EAAuB,SAAC,GAAkF,IAAhFC,EAA+E,EAA/EA,UAAWnB,EAAoE,EAApEA,KAAMoB,EAA8D,EAA9DA,cAAeC,EAA+C,EAA/CA,eAAgBC,EAA+B,EAA/BA,gBAAiBC,EAAc,EAAdA,QAC7F,OACI,sBAAKJ,UAAWK,IAAGC,IAAEC,QAASP,GAA9B,UACI,mCACI,8BAAK,4BAAInB,EAAK2B,aACd,8BAAM3B,EAAK4B,iBAEf,sBAAKT,UAAWM,IAAEI,WAAlB,UACI,+BACI,qBAAIV,UAAWK,IAAGC,IAAEK,UAAW9B,EAAK+B,aAAeN,IAAEO,UAArD,UACI,gDACA,+BAAOvB,EAAWT,EAAK+B,kBAE1B/B,EAAK+B,aAAe,qBAAIZ,UAAWK,IAAGC,IAAEK,UAAW9B,EAAKiC,WAAaR,IAAEO,UAAnD,UACnB,iDACA,+BAAOvB,EAAWT,EAAKiC,gBAExBjC,EAAKiC,WACN,qBAAId,UAAWK,IAAGC,IAAEK,UAAW9B,EAAKkC,WAAaT,IAAEO,UAAnD,UACE,8CACA,+BAAOvB,EAAWT,EAAKkC,gBAGxBlC,EAAKkC,WACN,qBAAIf,UAAWK,IAAGC,IAAEK,UAAW9B,EAAKmC,SAAWV,IAAEO,UAAjD,UACE,+CACA,+BAAOvB,EAAWT,EAAKmC,iBAI7B,sBAAKhB,UAAWM,IAAEW,QAAlB,UACI,wBAAQjB,UAAWM,IAAEY,eAAgBC,QAASjB,EAAgBkB,WAAYvC,EAAKmC,QAA/E,oBACA,wBAAQhB,UAAWM,IAAEe,YAAaF,QAASf,EAA3C,yBAGR,sBAAKJ,UAAWM,IAAEgB,OAAlB,UACKzC,EAAKyC,QAAUzC,EAAKyC,OAAOC,KAAI,SAACC,EAAOC,GAAR,OAC5B,sBAAezB,UAAWM,IAAEkB,MAAOL,QAAS,kBAAMlB,EAAcwB,IAAhE,UACI,qBAAKC,IAAI,GAAGC,IAAKH,IACjB,sBAAMxB,UAAWM,IAAEsB,OAAnB,oBAFMH,MAKd,qBAAKzB,UAAWM,IAAEuB,SAAUV,QAAShB,EAArC,iCAQD2B,iBAAK/B,G,wCC0CJgC,EAjGc,SAAC,GAA2B,IAAzBC,EAAwB,EAAxBA,QAASC,EAAe,EAAfA,SAChCC,EAAWC,iBAAyB,MAE1C,EAA4BC,mBAA6B,MAAzD,mBAAOC,EAAP,KAAeC,EAAf,KACA,EAAiCF,oBAAkB,GAAnD,mBAAOG,EAAP,KAAqBC,EAArB,KACA,EAAgCJ,oBAAkB,GAAlD,mBAAOK,EAAP,KAAkBC,EAAlB,KAEMC,EAAaC,sBAAW,sBAAC,4BAAAC,EAAA,0DACvBX,EAASY,QADc,uBAEvBZ,EAASY,QAAQC,iBAAiB,kBAAkB,WAChDC,QAAQC,IAAI,eACZT,GAAS,MAEbN,EAASY,QAAQC,iBAAiB,SAAS,WACvCC,QAAQC,IAAI,gBACZX,EAAU,MACVE,GAAS,MATU,SAWPU,UAAUC,aAAaC,aAAa,CAChDC,OAAO,EACPC,MAAO,CACHC,WAAY,iBAdG,OAWjBjD,EAXiB,OAiBvB0C,QAAQC,IAAI,kBACZX,EAAUhC,GACV4B,EAASY,QAAQU,UAAYlD,EAnBN,2CAqB5B,IAyDH,OAnCAmD,qBAAU,WACN,IAAMH,EAAQpB,EAASY,QAIvB,OAHKT,GACDM,IAEG,WACHW,GAASA,EAAMI,QACfrB,GAAUA,EAAOsB,YAAYC,SAAQ,SAAUC,GAC3CA,EAAMC,aAGf,CAACnB,EAAYN,IAEhBoB,qBAAU,WACN,IAAMM,EAAM,OAAG1B,QAAH,IAAGA,OAAH,EAAGA,EAAQ2B,iBACjBC,EAAaF,GAAUA,EAAO,GACpC,GAAIE,GAAc1B,EAAc,CAC5B,IAAM2B,EAAeD,EAAWE,kBAE5BD,EAAaE,MACbH,EAAWI,iBAAiB,CAExBC,SAAU,CAAC,CAAEF,MAAO3B,MAInByB,EAAaK,OAClBN,EAAWI,iBAAiB,CAExBC,SAAU,CAAC,CAAEC,MAAO9B,SAIjC,CAACA,EAAWF,EAAcF,IAGzB,sBAAKrC,UAAWK,IAAGC,IAAEC,SAArB,UACI,uBAAOP,UAAWM,IAAEgD,MAAOkB,IAAKtC,EAAUuC,UAAQ,EAACC,OAAK,EAACC,aAAW,IACpE,sBAAK3E,UAAWM,IAAEW,QAAlB,UACI,wBAAQjB,UAAWM,IAAEsE,WAAYzD,QAASc,EAAUb,UAAWmB,EAA/D,kBACA,wBAAQvC,UAAWM,IAAEuE,gBAAiB1D,QA5DhC,WACd,IAAMmC,EAAQpB,EAASY,QACvB,GAAKQ,EAAL,CAGA,IAAMwB,EAAcC,SAASC,cAAc,UAE3CF,EAAYG,OAAS3B,EAAM4B,YADH,EAExBJ,EAAYK,MAAQ7B,EAAM8B,WAFF,EAGxB,IAAMC,EAAeP,EAAYQ,WAAW,MAE5C,GAAKD,EAAL,CAGAA,EAAaE,UAAUjC,EAAO,EAAG,EAAGA,EAAM8B,WARlB,EAQgD9B,EAAM4B,YARtD,GAUxB,IAAMM,EAAUV,EAAYW,UAAU,aAAc,IACpDzD,EAAQwD,MA2C0DpE,UAAWmB,EAArE,yBACA,wBAAQvC,UAAWM,IAAEoF,YAAavE,QAAS,kBAAIuB,GAAYD,IAAYrB,UAAWmB,EAAlF,0BC5DAoD,EAzBc,SAAC,GAAkF,IAAhF3F,EAA+E,EAA/EA,UAAWC,EAAoE,EAApEA,cAAe1B,EAAqD,EAArDA,MAAO2B,EAA8C,EAA9CA,eAAgB0F,EAA8B,EAA9BA,WAAYC,EAAkB,EAAlBA,YAC1F,EAAkCzD,mBAAsB,MAAxD,mBAAO0D,EAAP,KAAkBC,EAAlB,KAIA,OAFA/C,QAAQC,IAAI1E,GAGR,sBAAKyB,UAAWK,IAAGC,IAAEC,QAASP,GAA9B,UACI,6BACKzB,EAAMgD,KAAI,SAAA1C,GAAI,OAAI,6BACf,cAAC,EAAD,CACUA,KAAMA,EACNoB,cAAe,SAAA+F,GAAK,OAAI/F,EAAcpB,EAAMmH,IAC5C7F,gBAAiB,kBAAM4F,EAAalH,IACpCqB,eAAgB,kBAAMA,EAAerB,IACrCuB,QAAS,kBAAMyF,EAAYhH,KALtBA,EAAKD,YAQ3BkH,GAAa,cAAC,EAAD,CAAW7D,SAAU,kBAAM8D,EAAa,OAAO/D,QAAS,SAACiE,GACnEL,EAAWE,EAAWG,GACtBF,EAAa,a,cClChBG,EAAb,aAGI,WAAqB1H,GAAgB,yBAAhBA,QAAe,KAF3BF,KAAO,eAMP6H,EAAb,aAGI,WAAqBtH,GAAa,yBAAbA,OAAY,KAFxBP,KAAO,gB,kBCRd8H,EAAO,4D,4CAEN,8BAAAvD,EAAA,sEACoBwD,MAAM,GAAD,OAAID,EAAJ,WADzB,cACGE,EADH,gBAEyBA,EAASC,OAFlC,cAEGhI,EAFH,yBAGIA,GAHJ,4C,sBAMA,SAAeiI,EAAtB,kC,4CAAO,WAA0B3H,GAA1B,mBAAAgE,EAAA,6DACKjE,EAAoBC,EAApBD,IAAQ6H,EADb,YACyB5H,EADzB,YAEoBwH,MAAM,GAAD,OAAID,EAAJ,kBAAkBxH,GAAO,CACjD8H,OAAQ,MACRC,QAAS,CAAE,eAAgB,oBAC3BC,KAAMC,KAAKC,UAAUL,KALtB,cAEGH,EAFH,yBAOIA,GAPJ,4C,sBCEP,IA+DgBS,EA/De,WAC3B,MAA8BC,qBAAWjI,GAAzC,mBAASR,EAAT,KAASA,MAASa,EAAlB,KAEAqE,qBAAU,YDXP,WAAP,gCCYQwD,GAAaC,MAAK,SAAA3I,GAAK,OAAIa,EAAS,IAAI8G,EAAgB3H,SACzD,CAACa,IA+CJ,OAAQ,qBAAKY,UAAWM,IAAEC,QAAlB,SACA,cAAC,EAAD,CAAWhC,MAAOA,EACP0B,cAvCC,SAACpB,EAAYmH,GAC7B,IAAM1E,EAAM,YAAOzC,EAAKyC,QAClB6F,EAAO,2BAAQtI,GAAR,IAAcyC,OAAQA,EAAO8F,OAAOpB,EAAO,KACxDQ,EAAWW,GACX/H,EAAS,IAAI+G,EAAiBgB,KAoCfvB,WAhDD,SAAC/G,EAAY2G,GAC3B,IAAMlE,EAASzC,EAAKyC,QAAU,GACxB6F,EAAO,2BAAQtI,GAAR,IAAcyC,OAAO,GAAD,mBAAMA,GAAN,CAAckE,MAC/CgB,EAAWW,GACX/H,EAAS,IAAI+G,EAAiBgB,KA6CfjH,eAlCF,SAACrB,GACd,IAAMsI,EAAO,eACNtI,GAEHsI,EAAQnG,UACDmG,EAAQpG,UACfoG,EAAQnG,SAAU,IAAIvB,MAAO4H,cACtBF,EAAQrG,UACfqG,EAAQpG,WAAY,IAAItB,MAAO4H,cACxBF,EAAQvG,YACfuG,EAAQrG,WAAY,IAAIrB,MAAO4H,cAE/BF,EAAQvG,aAAc,IAAInB,MAAO4H,eAErCb,EAAWW,GACX/H,EAAS,IAAI+G,EAAiBgB,KAoBftB,YAjBD,SAAChH,GACf,IAAMsI,EAAO,2BACNtI,GADM,IAETmC,aAASsG,EACTvG,eAAWuG,EACXxG,eAAWwG,EACX1G,iBAAa0G,IAEjBd,EAAWW,GACX/H,EAAS,IAAI+G,EAAiBgB,UC9CvBI,EAVH,WACR,OACI,qBAAKvH,UAAWM,IAAEC,QAAlB,SACI,cAAC,EAAD,UACI,cAAC,EAAD,SCGViH,EAAcC,QACW,cAA7BC,OAAOlH,SAASmH,UAEe,UAA7BD,OAAOlH,SAASmH,UAEhBD,OAAOlH,SAASmH,SAASC,MAAM,2DA0CnC,SAASC,EAAgBC,EAAeC,GACtC7E,UAAU8E,cACPC,SAASH,GACTZ,MAAK,SAACgB,GACLA,EAAaC,cAAgB,WAC3B,IAAMC,EAAmBF,EAAaG,WACd,MAApBD,IAGJA,EAAiBE,cAAgB,WACA,cAA3BF,EAAiBhK,QACf8E,UAAU8E,cAAcO,YAI1BvF,QAAQC,IACN,+GAKE8E,GAAUA,EAAOS,UACnBT,EAAOS,SAASN,KAMlBlF,QAAQC,IAAI,sCAGR8E,GAAUA,EAAOU,WACnBV,EAAOU,UAAUP,WAO5BQ,OAAM,SAACC,GACN3F,QAAQ2F,MAAM,4CAA6CA,MC5FjEC,IAASC,OACP,cAAC,IAAMC,WAAP,UACE,cAAC,EAAD,MAEF/D,SAASgE,eAAe,SDcnB,SAAkBhB,GACvB,GAA6C,kBAAmB7E,UAAW,CAGzE,GADkB,IAAI8F,IAAIC,YAAwBvB,OAAOlH,SAAS0I,MACpDC,SAAWzB,OAAOlH,SAAS2I,OAIvC,OAGFzB,OAAO3E,iBAAiB,QAAQ,WAC9B,IAAM+E,EAAK,UAAMmB,YAAN,sBAEPzB,IAgEV,SAAiCM,EAAeC,GAE9C1B,MAAMyB,EAAO,CACXnB,QAAS,CAAE,iBAAkB,YAE5BO,MAAK,SAACZ,GAEL,IAAM8C,EAAc9C,EAASK,QAAQ0C,IAAI,gBAEnB,MAApB/C,EAASgD,QACO,MAAfF,IAA8D,IAAvCA,EAAYG,QAAQ,cAG5CrG,UAAU8E,cAAcwB,MAAMtC,MAAK,SAACgB,GAClCA,EAAauB,aAAavC,MAAK,WAC7BQ,OAAOlH,SAASkJ,eAKpB7B,EAAgBC,EAAOC,MAG1BW,OAAM,WACL1F,QAAQC,IAAI,oEAtFV0G,CAAwB7B,EAAOC,GAI/B7E,UAAU8E,cAAcwB,MAAMtC,MAAK,WACjClE,QAAQC,IACN,+GAMJ4E,EAAgBC,EAAOC,OCvC/B6B,K","file":"static/js/main.43e02039.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"TaskCard_wrapper__2pwFH\",\"milestones\":\"TaskCard_milestones__aQ1Fm\",\"milestone\":\"TaskCard_milestone__1ZgSQ\",\"complete\":\"TaskCard_complete__2qkrJ\",\"photos\":\"TaskCard_photos__2EWg6\",\"photo\":\"TaskCard_photo__qubp1\",\"addPhoto\":\"TaskCard_addPhoto__2k0jz\",\"remove\":\"TaskCard_remove__5Qf8u\",\"buttons\":\"TaskCard_buttons__1SyS5\",\"completeButton\":\"TaskCard_completeButton__oOeo0\",\"resetButton\":\"TaskCard_resetButton__3Nj-C\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"TakePhoto_wrapper__2IAC6\",\"video\":\"TakePhoto_video__3jRgH\",\"buttons\":\"TakePhoto_buttons__10Dcp\",\"backButton\":\"TakePhoto_backButton__mVHoW\",\"takePhotoButton\":\"TakePhoto_takePhotoButton__3jwSX\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"App_wrapper__2yWJv\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"TasksList_wrapper__19HVx\"};","import { Task } from '../models/Task';\r\nimport { Action } from './state.actions';\r\n\r\nexport type State = {\r\n    tasks: Task[];\r\n};\r\n\r\nexport const reducer = (state: State, action: Action): State => {\r\n    switch (action.type) {\r\n        case 'LoadTasks':\r\n            return {\r\n                ...state,\r\n                tasks: [...action.value],\r\n            };\r\n\r\n        case 'UpdateTask': {\r\n            const taskIdx = state.tasks.findIndex(t => t._id === action.task._id);\r\n            if (!taskIdx) {\r\n                return state;\r\n            }\r\n            const tasks = state.tasks;\r\n            tasks[taskIdx] = { ...action.task };\r\n            return {\r\n                ...state,\r\n                tasks: [...tasks],\r\n            };\r\n        }\r\n\r\n        default:\r\n            return state;\r\n    }\r\n};\r\n\r\nexport const initialState: State = {\r\n    tasks: [],\r\n};\r\n","import { initialState, reducer, State } from './state.reducer';\r\nimport { ReactNode, useReducer, createContext } from 'react';\r\nimport { Action } from './state.actions';\r\n\r\nexport const StateContext = createContext<\r\n    [State, (action: Action) => void]\r\n>([initialState, () => {}]);\r\n\r\nexport const StateProvider = ({ children }: { children: ReactNode }) => {\r\n    const [state, dispatch] = useReducer(reducer, initialState);\r\n    return (\r\n        <StateContext.Provider value={[state, dispatch]}>\r\n            {children}\r\n        </StateContext.Provider>\r\n    );\r\n};\r\n","export const formatTime = (str?: string): string => {\r\n    if (!str) {\r\n        return '';\r\n    }\r\n    try {\r\n        const date = new Date(str);\r\n        return `${date.getHours()}:${date.getMinutes().toString().padStart(2, '0')}`;\r\n    } catch (e) {\r\n        return '';\r\n    }\r\n};\r\n","import { FC, memo } from 'react';\r\nimport cn from 'classnames';\r\n\r\nimport s from './TaskCard.module.css';\r\nimport { Task } from '../../models/Task';\r\nimport { formatTime } from '../../utils/date.utils';\r\n\r\ninterface IProps {\r\n    className?: string;\r\n    task: Task;\r\n    onPhotoRemove: (idx: number) => void;\r\n    onCompleteStep: () => void;\r\n    onReset: () => void;\r\n    onPhotoAddStart: () => void;\r\n}\r\n\r\nconst TaskCard: FC<IProps> = ({ className, task, onPhotoRemove, onCompleteStep, onPhotoAddStart, onReset }) => {\r\n    return (\r\n        <div className={cn(s.wrapper, className)}>\r\n            <header>\r\n                <div><b>{task.location}</b></div>\r\n                <div>{task.description}</div>\r\n            </header>\r\n            <div className={s.milestones}>\r\n                <ul>\r\n                    <li className={cn(s.milestone, task.travelStart && s.complete)}>\r\n                        <b>Travel started </b>\r\n                        <span>{formatTime(task.travelStart)}</span>\r\n                    </li>\r\n                    {task.travelStart && <li className={cn(s.milestone, task.travelEnd && s.complete)}>\r\n                      <b>Travel finished </b>\r\n                      <span>{formatTime(task.travelEnd)}</span>\r\n                    </li>}\r\n                    {task.travelEnd &&\r\n                    <li className={cn(s.milestone, task.workStart && s.complete)}>\r\n                      <b>Work started </b>\r\n                      <span>{formatTime(task.workStart)}</span>\r\n                    </li>\r\n                    }\r\n                    {task.workStart &&\r\n                    <li className={cn(s.milestone, task.workEnd && s.complete)}>\r\n                      <b>Work finished </b>\r\n                      <span>{formatTime(task.workEnd)}</span>\r\n                    </li>\r\n                    }\r\n                </ul>\r\n                <div className={s.buttons}>\r\n                    <button className={s.completeButton} onClick={onCompleteStep} disabled={!!task.workEnd}>▶</button>\r\n                    <button className={s.resetButton} onClick={onReset}>Reset</button>\r\n                </div>\r\n            </div>\r\n            <div className={s.photos}>\r\n                {task.photos && task.photos.map((photo, idx) =>\r\n                    <div key={idx} className={s.photo} onClick={() => onPhotoRemove(idx)}>\r\n                        <img alt=\"\" src={photo}/>\r\n                        <span className={s.remove}>×</span>\r\n                    </div>,\r\n                )}\r\n                <div className={s.addPhoto} onClick={onPhotoAddStart}>\r\n                    📷\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default memo(TaskCard);\r\n","import { FC, useRef, useState, useEffect, useCallback } from 'react';\r\nimport cn from 'classnames';\r\n\r\nimport s from './TakePhoto.module.css';\r\n\r\ninterface IProps {\r\n    className?: string;\r\n    onPhoto: (dataUrl: string) => void;\r\n    onCancel: () => void;\r\n}\r\n\r\nconst TakePhoto: FC<IProps> = ({ onPhoto, onCancel }) => {\r\n    const videoRef = useRef<HTMLVideoElement>(null);\r\n\r\n    const [stream, setStream] = useState<MediaStream | null>(null);\r\n    const [isVideoReady, setReady] = useState<boolean>(false);\r\n    const [isTorchOn, setTorchOn] = useState<boolean>(false);\r\n\r\n    const initStream = useCallback(async () => {\r\n        if (videoRef.current) {\r\n            videoRef.current.addEventListener('loadedmetadata', () => {\r\n                console.log('video ready');\r\n                setReady(true);\r\n            });\r\n            videoRef.current.addEventListener('ended', () => {\r\n                console.log('stream ended');\r\n                setStream(null);\r\n                setReady(false);\r\n            });\r\n            const s = await navigator.mediaDevices.getUserMedia({\r\n                audio: false,\r\n                video: {\r\n                    facingMode: 'environment',\r\n                },\r\n            });\r\n            console.log('setting stream');\r\n            setStream(s);\r\n            videoRef.current.srcObject = s;\r\n        }\r\n    }, []);\r\n\r\n    const takePhoto = () => {\r\n        const video = videoRef.current;\r\n        if (!video) {\r\n            return;\r\n        }\r\n        const videoCanvas = document.createElement('canvas');\r\n        const scaleDownFactor = 2;\r\n        videoCanvas.height = video.videoHeight / scaleDownFactor;\r\n        videoCanvas.width = video.videoWidth / scaleDownFactor;\r\n        const videoContext = videoCanvas.getContext('2d');\r\n\r\n        if (!videoContext) {\r\n            return;\r\n        }\r\n        videoContext.drawImage(video, 0, 0, video.videoWidth / scaleDownFactor, video.videoHeight / scaleDownFactor);\r\n\r\n        const dataUrl = videoCanvas.toDataURL('image/webp', 0.8);\r\n        onPhoto(dataUrl);\r\n    };\r\n\r\n    useEffect(() => {\r\n        const video = videoRef.current;\r\n        if (!stream) {\r\n            initStream();\r\n        }\r\n        return () => {\r\n            video && video.pause();\r\n            stream && stream.getTracks().forEach(function (track) {\r\n                track.stop();\r\n            });\r\n        };\r\n    }, [initStream, stream]);\r\n\r\n    useEffect(() => {\r\n        const tracks = stream?.getVideoTracks();\r\n        const videoTrack = tracks && tracks[0];\r\n        if (videoTrack && isVideoReady) {\r\n            const capabilities = videoTrack.getCapabilities();\r\n            // @ts-ignore\r\n            if (capabilities.torch) {\r\n                videoTrack.applyConstraints({\r\n                    // @ts-ignore\r\n                    advanced: [{ torch: isTorchOn }],\r\n                });\r\n            }\r\n            // @ts-ignore\r\n            else if (capabilities.flash) {\r\n                videoTrack.applyConstraints({\r\n                    // @ts-ignore\r\n                    advanced: [{ flash: isTorchOn }],\r\n                });\r\n            }\r\n        }\r\n    }, [isTorchOn, isVideoReady, stream]);\r\n\r\n    return (\r\n        <div className={cn(s.wrapper)}>\r\n            <video className={s.video} ref={videoRef} autoPlay muted playsInline/>\r\n            <div className={s.buttons}>\r\n                <button className={s.backButton} onClick={onCancel} disabled={!isVideoReady}>Back</button>\r\n                <button className={s.takePhotoButton} onClick={takePhoto} disabled={!isVideoReady}>Take photo!</button>\r\n                <button className={s.torchButton} onClick={()=>setTorchOn(!isTorchOn)} disabled={!isVideoReady}>Flash</button>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default (TakePhoto);\r\n","import { FC, useState } from 'react';\r\nimport cn from 'classnames';\r\n\r\nimport s from './TasksList.module.css';\r\nimport { Task } from '../../models/Task';\r\nimport TaskCard from '../TaskCard/TaskCard';\r\nimport TakePhoto from '../TakePhoto/TakePhoto';\r\n\r\ninterface IProps {\r\n    className?: string;\r\n    tasks: Task[];\r\n    onPhotoAdd: (task: Task, data: string) => void;\r\n    onPhotoRemove: (task: Task, index: number) => void;\r\n    onCompleteStep: (task: Task) => void;\r\n    onTaskReset: (task: Task) => void;\r\n}\r\n\r\nconst TasksList: FC<IProps> = ({ className, onPhotoRemove, tasks, onCompleteStep, onPhotoAdd, onTaskReset }) => {\r\n    const [photoTask, setPhotoTask] = useState<Task | null>(null);\r\n\r\n    console.log(tasks);\r\n\r\n    return (\r\n        <div className={cn(s.wrapper, className)}>\r\n            <ul>\r\n                {tasks.map(task => <li>\r\n                    <TaskCard key={task._id}\r\n                              task={task}\r\n                              onPhotoRemove={index => onPhotoRemove(task, index)}\r\n                              onPhotoAddStart={() => setPhotoTask(task)}\r\n                              onCompleteStep={() => onCompleteStep(task)}\r\n                              onReset={() => onTaskReset(task)}/>\r\n                </li>)}\r\n            </ul>\r\n            {photoTask && <TakePhoto onCancel={() => setPhotoTask(null)} onPhoto={(data) => {\r\n                onPhotoAdd(photoTask, data);\r\n                setPhotoTask(null);\r\n            }}/>}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default (TasksList);\r\n","import { Task } from '../models/Task';\r\n\r\nexport class LoadTasksAction {\r\n    readonly type = 'LoadTasks';\r\n\r\n    constructor(readonly value: Task[]) {\r\n    }\r\n}\r\n\r\nexport class UpdateTaskAction {\r\n    readonly type = 'UpdateTask';\r\n\r\n    constructor(readonly task: Task) {\r\n    }\r\n}\r\n\r\nexport class AddPhotoAction {\r\n    readonly type = 'AddPhoto';\r\n\r\n    constructor(readonly taskId: string, readonly photo: string) {\r\n    }\r\n}\r\n\r\nexport class RemovePhotoAction {\r\n    readonly type = 'RemovePhoto';\r\n\r\n    constructor(readonly taskId: string, readonly index: number) {\r\n    }\r\n}\r\n\r\nexport class CompleteStepAction {\r\n    readonly type = 'CompleteStep';\r\n\r\n    constructor(readonly taskId: string) {\r\n    }\r\n}\r\n\r\nexport class ResetTaskAction {\r\n    readonly type = 'ResetTask';\r\n\r\n    constructor(readonly taskId: string) {\r\n    }\r\n}\r\n\r\nexport type Action = LoadTasksAction | AddPhotoAction | RemovePhotoAction | CompleteStepAction | ResetTaskAction | UpdateTaskAction;\r\n","import { Task } from '../models/Task';\r\n\r\nconst base = 'https://crudcrud.com/api/1aa10a5e89e24398bd56391f380dddd3';\r\n\r\nexport async function fetchTasks() {\r\n    const response = await fetch(`${base}/tasks`);\r\n    const tasks: Task[] = await response.json();\r\n    return tasks;\r\n}\r\n\r\nexport async function updateTask(task: Task) {\r\n    const { _id, ...content } = task;\r\n    const response = await fetch(`${base}/tasks/${_id}`, {\r\n        method: 'PUT',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(content),\r\n    });\r\n    return response;\r\n}\r\n","import { FC, useContext, useEffect } from 'react';\r\n\r\nimport s from './TasksScene.module.css';\r\nimport TasksList from '../../components/TasksList/TasksList';\r\nimport { StateContext } from '../../state/state.context';\r\nimport { Task } from '../../models/Task';\r\nimport { LoadTasksAction, UpdateTaskAction } from '../../state/state.actions';\r\nimport { fetchTasks, updateTask } from '../../services/data.service';\r\n\r\ninterface IProps {\r\n}\r\n\r\nconst TasksScene: FC<IProps> = () => {\r\n    const [{ tasks }, dispatch] = useContext(StateContext);\r\n\r\n    useEffect(() => {\r\n        fetchTasks().then(tasks => dispatch(new LoadTasksAction(tasks)));\r\n    }, [dispatch]);\r\n\r\n    const savePhoto = (task: Task, dataUrl: string) => {\r\n        const photos = task.photos || [];\r\n        const updated = { ...task, photos: [...photos, dataUrl] };\r\n        updateTask(updated);\r\n        dispatch(new UpdateTaskAction(updated));\r\n\r\n    };\r\n\r\n    const removePhoto = (task: Task, index: number) => {\r\n        const photos = [...task.photos];\r\n        const updated = { ...task, photos: photos.splice(index, 1) };\r\n        updateTask(updated);\r\n        dispatch(new UpdateTaskAction(updated));\r\n    };\r\n\r\n    const stepTask = (task: Task) => {\r\n        const updated = {\r\n            ...task,\r\n        };\r\n        if (updated.workEnd) {\r\n        } else if (updated.workStart) {\r\n            updated.workEnd = new Date().toISOString();\r\n        } else if (updated.travelEnd) {\r\n            updated.workStart = new Date().toISOString();\r\n        } else if (updated.travelStart) {\r\n            updated.travelEnd = new Date().toISOString();\r\n        } else {\r\n            updated.travelStart = new Date().toISOString();\r\n        }\r\n        updateTask(updated);\r\n        dispatch(new UpdateTaskAction(updated));\r\n    };\r\n\r\n    const resetTask = (task: Task) => {\r\n        const updated = {\r\n            ...task,\r\n            workEnd: undefined,\r\n            workStart: undefined,\r\n            travelEnd: undefined,\r\n            travelStart: undefined,\r\n        };\r\n        updateTask(updated);\r\n        dispatch(new UpdateTaskAction(updated));\r\n    };\r\n\r\n    return (<div className={s.wrapper}>\r\n            <TasksList tasks={tasks}\r\n                       onPhotoRemove={removePhoto}\r\n                       onPhotoAdd={savePhoto}\r\n                       onCompleteStep={stepTask}\r\n                       onTaskReset={resetTask}\r\n            />\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default (TasksScene);\r\n","import React from 'react';\r\nimport s from './App.module.css';\r\nimport { StateProvider } from './state/state.context';\r\nimport TasksScene from './scenes/TasksScene/TasksScene';\r\n\r\nconst App = () => {\r\n    return (\r\n        <div className={s.wrapper}>\r\n            <StateProvider>\r\n                <TasksScene/>\r\n            </StateProvider>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default App;\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://cra.link/PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)\r\n);\r\n\r\ntype Config = {\r\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\r\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\r\n};\r\n\r\nexport function register(config?: Config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://cra.link/PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl: string, config?: Config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then((registration) => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://cra.link/PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch((error) => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' },\r\n  })\r\n    .then((response) => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then((registration) => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log('No internet connection found. App is running in offline mode.');\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready\r\n      .then((registration) => {\r\n        registration.unregister();\r\n      })\r\n      .catch((error) => {\r\n        console.error(error.message);\r\n      });\r\n  }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './normalize.css';\r\nimport './index.css';\r\nimport App from './App';\r\nimport * as serviceWorkerRegistration from './serviceWorkerRegistration';\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\nserviceWorkerRegistration.register();\r\n"],"sourceRoot":""}